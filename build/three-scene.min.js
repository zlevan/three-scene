
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("three"),require("three/examples/jsm/libs/tween.module.js"),require("three/examples/jsm/controls/OrbitControls"),require("three/examples/jsm/loaders/RGBELoader.js"),require("three-cruise-path")):"function"==typeof define&&define.amd?define(["exports","three","three/examples/jsm/libs/tween.module.js","three/examples/jsm/controls/OrbitControls","three/examples/jsm/loaders/RGBELoader.js","three-cruise-path"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).THREE=e.THREE||{},e.THREE,e.TWEEN,e.OrbitControls,e.RGBELoader_js,e.threeCruisePath)}(this,(function(e,t,i,r,n,o){"use strict";function s(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(i){if("default"!==i){var r=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(t,i,r.get?r:{enumerable:!0,get:function(){return e[i]}})}})),t.default=e,Object.freeze(t)}var a=s(t),c=s(i);"function"==typeof SuppressedError&&SuppressedError;const l=e=>((e,t)=>Object.prototype.toString.call(t)===`[object ${e}]`)("Object",e),h=(e,t=new Map)=>{if(null!=e&&l(e)){let i=t.get(e);if(i)return i;const r=Array.isArray(e);let n=r?[]:{};return i=t.set(e,n),r?e.forEach(((e,t)=>{n[t]=h(e,i)})):Object.keys(e).forEach((t=>{l(n[t])?n[t]=h(e[t],i):n[t]=e[t]})),n}return e},d=(e,t)=>{e=h(e);for(let i in t)i in e&&l(t[i])&&l(e[i])?e[i]=d(e[i],t[i]):e[i]=t[i];return e},p=(e,t="")=>Array.isArray(e)?e.map((e=>p(e,t))):!(e=>{if(!e&&(e=""),!/^([hH][tT]{2}[pP]:\/\/|[hH][tT]{2}[pP][sS]:\/\/)[a-zA-Z0-9\-\.]+\.[a-zA-Z]{2,}(\/\S*)?$/.test(e))return/^(https?:\/\/)(?:\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})(?::\d{1,5})?(?:[/?#]\S*)?$/.test(e);return!0})(e)&&e.indexOf(t)<0?t+e:e;var u={container:document.body,width:window.innerWidth,height:window.innerHeight,baseUrl:"",bgColor:null,bgUrl:null,env:null,scale:1,fog:{visible:!1,near:100,far:1e3},render:{antialias:!0,logarithmicDepthBuffer:!0,preserveDrawingBuffer:!1},controls:{visible:!0,autoRotate:!1,autoRotateSpeed:2,enableDamping:!1,dampingFactor:.25,enablePan:!0,enableRotate:!0,enableZoom:!0,maxAzimuthAngle:1/0,minAzimuthAngle:1/0,minDistance:1,maxDistance:2e3,minPolarAngle:0,maxPolarAngle:Math.PI,maxTargetRadius:1/0,rotateSpeed:1,screenSpacePanning:!0},ambientLight:{visible:!0,color:16777215,intensity:1.5},directionalLight:{visible:!0,helper:!1,position:[500,1e3,800],position2:[-500,800,-800],light2:!0,color:16777215,intensity:1.5},camera:{helper:!1,near:1,far:1e4,position:[-350,510,700]},cruise:{visible:!1,enabled:!1,runing:!1,helper:!1,points:[],segment:2,tension:0,baseUrl:"",repeat:[.1,1],width:15,speed:1,mapSpeed:.006,offset:10,factor:1,auto:!1,animateBack:void 0},grid:{visible:!1,opacity:.3,transparent:!0,width:800,divisions:80,centerLineColor:10592673,gridColor:10592673,fork:!1,forkSize:1.4,forkColor:10592673},axes:{visible:!1,size:50}};const m=()=>{return{visible:!0,enabled:!1,runing:!1,helper:!1,points:[],segment:2,close:!0,tension:0,baseUrl:"",mapUrl:(e="arrow.png",new URL(`../assets/imgs/texttures/${e}`,"undefined"==typeof document&&"undefined"==typeof location?new(require("url").URL)("file:"+__filename).href:"undefined"==typeof document?location.href:document.currentScript&&"SCRIPT"===document.currentScript.tagName.toUpperCase()&&document.currentScript.src||new URL("three-scene.min.js",document.baseURI).href).href),repeat:[.1,1],width:15,speed:1,mapSpeed:.006,offset:10,factor:1,index:0,auto:!1,tube:!1,color:16777215,radius:1,radialSegments:1,animateBack:void 0};var e};var g,f;const{createCruise:b,cruiseAnimate:w,updateCruise:v,bindEvent:y,removeEvent:C}=(()=>{let e,t,i,r=m();const n=(t,n)=>{i=new a.Mesh(new a.SphereGeometry(2),new a.MeshBasicMaterial({color:0,opacity:.8,depthTest:!1,transparent:!0})),t.add(i);const o=(new a.BufferGeometry).setFromPoints(n.concat(n[0])),s=new a.LineBasicMaterial({color:255,opacity:1,depthTest:!1,transparent:!0}),c=new a.Line(o,s);t.add(c);const l=new a.TubeGeometry(e,100,r.width/2,3,!0),h=new a.MeshLambertMaterial({color:16711935,opacity:.1,depthTest:!1,transparent:!0}),d=new a.Mesh(l,h),p=new a.MeshBasicMaterial({color:16715760,opacity:.3,wireframe:!0,depthTest:!1,transparent:!0}),u=new a.Mesh(l,p);d.add(u),t.add(d)},s=()=>{var e;return 900*(null!==(e=r.segment)&&void 0!==e?e:2)},c=()=>null==e?void 0:e.getPoints(s()),l=(e,t)=>new a.Vector3(t.x,t.y+e,t.z),h=e=>{if(!r.enabled)return;switch(e.keyCode){case 38:case 87:r.runing?(r.factor*=1.5,r.factor>10&&(r.factor=10)):r.index+=5;break;case 83:case 40:r.runing||(r.index-=5,r.index<0&&(r.index=s()))}},u=e=>{if(!r.enabled)return;r.factor=1;switch(e.keyCode){case 32:r.runing=!r.runing;break;case 38:case 87:r.runing||(r.index+=10);break;case 83:case 40:r.runing||(r.index-=10,r.index<0&&(r.index=s()))}};return{createCruise:(i={},s)=>{r=d(m(),i);const{points:l,tension:h,mapUrl:u,baseUrl:g,repeat:f,width:b,helper:w,close:v,tube:y,color:C,radius:x,radialSegments:j}=r,L=[];for(let e=0;e<l.length;e++){const t=l[e];L.push(new a.Vector3(t[0],t[1],t[2]))}e=new a.CatmullRomCurve3(L,v,"catmullrom",null!=h?h:0),e=new a.CatmullRomCurve3(c(),v,"catmullrom",null!=h?h:0);const E=new a.Group;t=(new a.TextureLoader).load(p(u,g),(e=>{e.wrapS=a.RepeatWrapping,e.repeat.x=f[0],e.repeat.y=f[1],e.anisotropy=s.capabilities.getMaxAnisotropy()}));const M=new a.MeshPhongMaterial({color:C,map:t,opacity:.9,transparent:!0,depthTest:!0,side:a.FrontSide}),P=new a.Vector3(0,1,0),k=new o.PathPointList;k.set(c(),x,j,P,!1);const S=y?new o.PathTubeGeometry:new o.PathGeometry;S.update(k,y?{radius:x,radialSegments:j,progress:1,startRad:0}:{width:b,arrow:!1,progress:1,side:"both"}),console.log(S);const O=new a.Mesh(S,M);return E.add(O),E.name="cruise",w&&n(E,L),E.renderOrder=99,E},updateCruise:(e={})=>{r=d(r,e)},cruiseAnimate:n=>{if(!n)return;if(!e)return;const{mapSpeed:o,speed:a,factor:c,enabled:h,runing:d,offset:p,helper:u,auto:m,animateBack:g}=r;if(t&&(t.offset.x-=o),!(m||d&&h))return;(m||d&&h)&&(r.index+=c*a);const f=s(),b=r.index%f/f;let w=b+.001;w>1&&(w-=1);const v=e.getPointAt(w);if(u&&i){const e=l(p,v);i.position.copy(e)}const y=l(p,e.getPointAt(b));if(!m||d&&h){n.position.copy(y);const e=l(p,v);n._lookAt_=e,n.lookAt(e)}"function"==typeof g&&g(y,v,e,b)},bindEvent:()=>{window.addEventListener("keydown",h,!1),window.addEventListener("keyup",u,!1)},removeEvent:()=>{window.removeEventListener("keyup",u),window.removeEventListener("keydown",h)}}})(),{createFork:x}={createFork:(e={})=>{const{width:t=800,divisions:i=80,forkSize:r=1.4,forkColor:n=10592673}=e;let o=t/i,s=-t/2;const c=new a.Group;for(let e=0;e<=i;e++)for(let t=0;t<=i;t++){const i=s+e*o,l=s+t*o,h=new a.PlaneGeometry(r,r/5),d=new a.MeshLambertMaterial({color:n,transparent:!0,opacity:.9}),p=new a.Mesh(h,d);p.rotateX(.5*-Math.PI),p.position.set(i,0,l);const u=p.clone();u.rotateZ(.5*Math.PI),c.add(p,u)}return c}};class j{constructor(e={}){g.add(this);const t=u;var i;this.options=d(t,e),j.total++,this.pointer={tsp:0,isClick:!1},(i=this.options.container)&&("object"==typeof HTMLElement?i instanceof HTMLElement:i&&"object"==typeof i&&1===i.nodeType&&"string"==typeof i.nodeName)?this.container=this.options.container:this.container=document.querySelector(this.options.container),this.options.width=this.container.offsetWidth,this.options.height=this.container.offsetHeight,this.scene=new a.Scene,this.renderer=this.initRenderer(),this.baseCamera=this.initCamera(),this.controls=this.initControls(),this.init(),this.initCruise(),console.log(this)}get camera(){const{visible:e,runing:t,auto:i}=this.options.cruise;return e&&this.cruiseCamera&&t?this.cruiseCamera:this.baseCamera}init(){this.initLight(),this.initGrid(),this.initAxes(),this.initModel()}run(){this.loop()}loop(){this.animationId=window.requestAnimationFrame((()=>{this.loop()})),this.animate(),this.modelAnimate()}animate(){var e;this.renderer&&this.renderer.render(this.scene,this.camera),this.options.controls.visible&&(null===(e=this.controls)||void 0===e||e.update()),w(this.cruiseCamera),c.update()}initModel(){}modelAnimate(){}initRenderer(){const{width:e,height:t,bgColor:i,bgUrl:r,env:n}=this.options,o=new a.WebGLRenderer(this.options.render);if(n&&this.setEnvironment(n),r?this.setBgTexture(r):this.setBgColor(i),this.options.fog.visible){const{color:e,near:t,far:i}=this.options.fog;this.scene.fog=new a.Fog(null!=e?e:this.scene.background,t,i)}return o.sortObjects=!0,o.shadowMap.enabled=!0,o.shadowMap.type=a.PCFSoftShadowMap,o.setSize(e,t),o.setPixelRatio(window.devicePixelRatio),this.container.appendChild(o.domElement),o}initLight(){const{ambientLight:e,directionalLight:t}=this.options;if(e.visible){const t=new a.AmbientLight(e.color,e.intensity);this.addObject(t)}if(t.visible){const e=this.createDirectionalLight(),[i=0,r=0,n=0]=t.position;if(e.position.set(i,r,n),this.addObject(e),t.helper){const t=new a.DirectionalLightHelper(e,1);this.addObject(t)}if(t.light2){const e=this.createDirectionalLight(!1),[i=0,r=0,n=0]=t.position2;if(e.position.set(i,r,n),this.addObject(e),t.helper){const t=new a.DirectionalLightHelper(e,1);this.addObject(t)}}}}createDirectionalLight(e=!0,t=2e3,i=4096,r=1,n=2e4){const{color:o,intensity:s}=this.options.directionalLight,c=new a.DirectionalLight(o,s);if(e){c.shadow.mapSize.setScalar(i),c.shadow.bias=-1e-5,c.shadow.normalBias=.01,c.castShadow=e;const o=c.shadow.camera;o.near=r,o.far=n,o.top=o.right=t,o.left=o.bottom=-t,o.updateProjectionMatrix()}return c}initCamera(){const{width:e,height:t,camera:i}=this.options;let r=new a.PerspectiveCamera(36,e/t,i.near,i.far);if(i.orthogonal){let n=e/t,o=260;r=new a.OrthographicCamera(-o*n,o*n,o,-o,i.near,i.far)}if(r.position.set(...i.position),r.lookAt(0,0,0),i.helper){const e=new a.CameraHelper(r);this.addObject(e)}return r}initControls(){const e=this.options.controls;if(!e.visible)return;const t=new r.OrbitControls(this.camera,this.renderer.domElement);return Object.keys(e).forEach((i=>{t[i]=e[i]})),t.target.set(0,0,0),t.saveState(),t}initCruise(){const{visible:e}=this.options.cruise;e&&(this.cruiseCamera=this.initCamera(),function(e,t,i,r){if("a"===i&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?r:"a"===i?r.call(e):r?r.value:t.get(e)}(this,g,"m",f).call(this))}initGrid(){const e=this.options.grid;if(!e.visible)return;const{width:t,divisions:i,centerLineColor:r,gridColor:n,opacity:o,transparent:s,fork:c}=e,l=new a.GridHelper(t,i,r,n);if(l.material.opacity=o,l.material.transparent=s,this.grid=l,this.addObject(l),c){const t=x(e);t.name="辅助交叉点",t._isGridFork_=!0,this.addObject(t)}}initAxes(){if(!this.options.axes.visible)return;const e=new a.AxesHelper(this.options.axes.size);this.addObject(e)}createGround(e=5e3,t,i=11721691){t=void 0===t?e:t;const r=new a.PlaneGeometry(e,t),n=new a.MeshPhongMaterial({color:i,shininess:10}),o=new a.Mesh(r,n);return o.name="ground",o.rotation.x=1.5*Math.PI,o.receiveShadow=!0,o}createClock(){this.clock=new a.Clock}setCruisePoint(e){this.options.cruise.points=e,this.createCruise()}createCruise(){const{visible:e,points:t}=this.options.cruise;if(!e)return;if(this.cruiseGroup&&this.disposeObj(this.cruiseGroup),y(),!t||0==t.length)return;const i=b(this.options.cruise,this.renderer);this.cruiseGroup=i,i.visible=!1,this.addObject(i)}toggleCruise(e){let{visible:t,runing:i,auto:r}=this.options.cruise;t&&(i=null!=e?e:i,this.options.cruise.runing=!i,this.options.cruise.enabled=!i,this.controls&&(this.controls.enabled=r||i),this.cruiseGroup&&(this.cruiseGroup.visible=!i),v(this.options.cruise))}toggleCruiseDepthTest(e){this.cruiseGroup&&this.cruiseGroup.traverse((t=>{(t.isMesh||t.isLine)&&(t.material.depthTest=null!=e?e:!t.material.depthTest)}))}setScale(e){this.options.scale=e}setEnvironment(e){(new n.RGBELoader).load(p(e,this.options.baseUrl),(e=>{e.mapping=a.EquirectangularReflectionMapping,this.scene.environment=e}))}setBgTexture(e){if(Array.isArray(e)){const t=(new a.CubeTextureLoader).load(p(e,this.options.baseUrl));this.scene.background=t}else this.scene.background=(new a.TextureLoader).load(p(e))}setBgColor(e){this.scene.background=e?new a.Color(e):null}bindEvent(){const e=this.renderer.domElement;e.addEventListener("dblclick",this.onDblclick.bind(this)),e.addEventListener("pointerdown",this.onPointerDown.bind(this)),e.addEventListener("pointermove",this.onPointerMove.bind(this)),e.addEventListener("pointerup",this.onPointerUp.bind(this))}onDblclick(e){}onPointerDown(e){this.pointer.isClick=!0,this.pointer.tsp=e.timeStamp}onPointerMove(e){}onPointerUp(e){this.pointer.isClick=!1}exportImage(){const e=document.createElement("a");e.download="render.png",e.href=this.renderer.domElement.toDataURL().replace("image/png","image/octet-stream"),e.click()}getPosition(){var e,t;return console.log("camera.position",this.camera.position),console.log("controls.target",null===(e=this.controls)||void 0===e?void 0:e.target),{position:this.camera.position,target:null===(t=this.controls)||void 0===t?void 0:t.target}}isCameraMove(e,t=1){const i=this.camera.position;return Math.abs(i.x-e.x)<t&&Math.abs(i.y-e.y)<t&&Math.abs(i.z-e.z)<t}addObject(...e){this.scene.add(...e)}controlSave(){var e;null===(e=this.controls)||void 0===e||e.saveState()}controlReset(){var e;null===(e=this.controls)||void 0===e||e.reset(),this.toggleCruise(!0)}getValidTargetPosition(e,t,i,r={x:-104,y:7,z:58}){const n=t||e.to||r,o=i||e.target||{x:0,y:0,z:0},s=this.controls;return s&&s.target&&s.target.set(o.x,o.y,o.z),n}resize(){this.options.width=this.container.offsetWidth||window.innerWidth,this.options.height=this.container.offsetHeight||window.innerHeight;const{width:e,height:t,camera:i}=this.options,r=e/t;i.orthogonal||(this.baseCamera.aspect=r),this.baseCamera.updateProjectionMatrix(),this.cruiseCamera&&(i.orthogonal||(this.cruiseCamera.aspect=r),this.cruiseCamera.updateProjectionMatrix()),this.renderer.setSize(e,t)}stopAnimate(){window.cancelAnimationFrame(this.animationId)}clear(e){e&&e.traverse&&(e.traverse((e=>{e.material&&e.material.dispose(),e.geometry&&e.geometry.dispose(),null==e||e.clear()})),null==e||e.clear())}disposeObj(e){e&&e.traverse&&(e.traverse((e=>{e.material&&e.material.dispose(),e.geometry&&e.geometry.dispose(),null==e||e.clear()})),null==e||e.clear(),this.scene.remove(e))}dispose(){var e;C(),this.stopAnimate();try{a.Cache.clear(),this.disposeObj(this.scene),this.scene.clear(),this.renderer.dispose(),this.renderer.forceContextLoss();let t=this.renderer.domElement.getContext("webgl");t&&(null===(e=t.getExtension("WEBGL_lose_context"))||void 0===e||e.loseContext()),this.disposeObj(this.cruiseGroup),this.disposeObj(this.grid),this.controls&&this.controls.dispose(),this.scene=void 0,this.renderer=void 0,this.baseCamera=void 0,this.cruiseCamera=void 0,this.controls=void 0,this.grid=void 0,this.cruiseGroup=void 0,this.container.innerHTML=""}catch(e){console.log(e)}}}g=new WeakSet,f=function(){const e=this.options.cruise;e.enabled=!1,e.runing=!1,e.baseUrl&&(e.baseUrl=this.options.baseUrl),e.factor=1},j.total=0;e.add=(e,t)=>e+t,e.default=j,Object.defineProperty(e,"__esModule",{value:!0})}));
